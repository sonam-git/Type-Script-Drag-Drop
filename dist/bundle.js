(()=>{"use strict";class e{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}function t(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t}function n(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}var r;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(r||(r={}));class s{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class i{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}class l extends i{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new l),this.instance}addProject(e,t,n){const i=new s(Math.random().toString(),e,t,n,r.Active);this.projects.push(i),this.udpateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.udpateListeners())}udpateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const o=l.getInstance();class a extends e{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}gatherUserInput(){const e=this.titleInputElement.value,n=this.descriptionInputElement.value,r=this.peopleInputElement.value,s={value:n,required:!0,minLength:5},i={value:r,required:!0,min:1};return t({value:e,required:!0})&&t(s)&&t(i)?[e,n,+r]:void alert("Invalid input, please try again!")}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;o.addProject(e,n,r),this.clearInputs()}}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([n],a.prototype,"submitHandler",null);class c extends e{get persons(){return 1===this.project.people?"1 person":`${this.project.people} persons`}constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("DragEnd")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons.toString()+" assigned",this.element.querySelector("p").textContent=this.project.description}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([n],c.prototype,"dragStartHandler",null);var d=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class p extends e{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const t=e.dataTransfer.getData("text/plain");o.moveProject(t,"active"===this.type?r.Active:r.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),o.addListener((e=>{const t=e.filter((e=>"active"===this.type?e.status===r.Active:e.status===r.Finished));this.assignedProjects=t,this.renderProjects()}))}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new c(this.element.querySelector("ul").id,e)}}d([n],p.prototype,"dragOverHandler",null),d([n],p.prototype,"dropHandler",null),d([n],p.prototype,"dragLeaveHandler",null),new a,new p("active"),new p("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VUFDaEIsSUFBSUEsRUFBWSxXIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvYmFzZS1jb21wb25lbnQudHMiLCJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC1wcm9qZWN0Ly4vc3JjL3V0aWwvdmFsaWRhdGlvbi50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXByb2plY3QvLi9zcmMvZGVjb3JhdG9ycy9hdXRvYmluZC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXByb2plY3QvLi9zcmMvbW9kZWxzL3Byb2plY3QudHMiLCJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC1wcm9qZWN0Ly4vc3JjL3N0YXRlL3Byb2plY3Qtc3RhdGUudHMiLCJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pbnB1dC50cyIsIndlYnBhY2s6Ly90eXBlc2NyaXB0LXByb2plY3QvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWl0ZW0udHMiLCJ3ZWJwYWNrOi8vdHlwZXNjcmlwdC1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1saXN0LnRzIiwid2VicGFjazovL3R5cGVzY3JpcHQtcHJvamVjdC8uL3NyYy9hcHAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiXG4gICAgLy8gQ29tcG9uZW50IEJhc2UgQ2xhc3NcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDb21wb25lbnQ8VCBleHRlbmRzIEhUTUxFbGVtZW50LCBVIGV4dGVuZHMgSFRNTEVsZW1lbnQ+IHtcbiAgICB0ZW1wbGF0ZUVsZW1lbnQ6IEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gICAgaG9zdEVsZW1lbnQ6IFQ7XG4gICAgZWxlbWVudDogVTtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgIHRlbXBsYXRlSWQ6IHN0cmluZyxcbiAgICAgIGhvc3RFbGVtZW50SWQ6IHN0cmluZyxcbiAgICAgIGluc2VydEF0U3RhcnQ6IGJvb2xlYW4sXG4gICAgICBuZXdFbGVtZW50SWQ/OiBzdHJpbmdcbiAgICApIHtcbiAgICAgIHRoaXMudGVtcGxhdGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgICAgIHRlbXBsYXRlSWRcbiAgICAgICkhIGFzIEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gICAgICB0aGlzLmhvc3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaG9zdEVsZW1lbnRJZCkhIGFzIFQ7XG4gIFxuICAgICAgY29uc3QgaW1wb3J0ZWROb2RlID0gZG9jdW1lbnQuaW1wb3J0Tm9kZShcbiAgICAgICAgdGhpcy50ZW1wbGF0ZUVsZW1lbnQuY29udGVudCxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICAgIHRoaXMuZWxlbWVudCA9IGltcG9ydGVkTm9kZS5maXJzdEVsZW1lbnRDaGlsZCBhcyBVO1xuICAgICAgaWYgKG5ld0VsZW1lbnRJZCkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuaWQgPSBuZXdFbGVtZW50SWQ7XG4gICAgICB9XG4gICAgICB0aGlzLmF0dGFjaChpbnNlcnRBdFN0YXJ0KTtcbiAgICB9XG4gIFxuICAgIHByaXZhdGUgYXR0YWNoKGluc2VydEF0QmVnaW5uaW5nOiBib29sZWFuKSB7XG4gICAgICB0aGlzLmhvc3RFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudChcbiAgICAgICAgaW5zZXJ0QXRCZWdpbm5pbmcgPyBcImFmdGVyYmVnaW5cIiA6IFwiYmVmb3JlZW5kXCIsXG4gICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgKTtcbiAgICB9XG4gICAgYWJzdHJhY3QgY29uZmlndXJlKCk6IHZvaWQ7XG4gICAgYWJzdHJhY3QgcmVuZGVyQ29udGVudCgpOiB2b2lkO1xuICB9XG4iLCJcbiAgICAvLyB2YWxpZGF0aW9uXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRhYmxlIHtcbiAgICB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyO1xuICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcbiAgICBtaW5MZW5ndGg/OiBudW1iZXI7XG4gICAgbWF4TGVuZ3RoPzogbnVtYmVyO1xuICAgIG1pbj86IG51bWJlcjtcbiAgICBtYXg/OiBudW1iZXI7XG4gIH1cbiAgXG4gZXhwb3J0ICBmdW5jdGlvbiB2YWxpZGF0ZSh2YWxpZGF0YWJsZUlucHV0OiBWYWxpZGF0YWJsZSkge1xuICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5yZXF1aXJlZCkge1xuICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggIT09IDA7XG4gICAgfVxuICAgIC8vIG1pbmxlbmd0aCB2YWxpZGF0aW9uXG4gICAgaWYgKFxuICAgICAgdmFsaWRhdGFibGVJbnB1dC5taW5MZW5ndGggIT0gbnVsbCAmJlxuICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09IFwic3RyaW5nXCJcbiAgICApIHtcbiAgICAgIGlzVmFsaWQgPVxuICAgICAgICBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUubGVuZ3RoID49IHZhbGlkYXRhYmxlSW5wdXQubWluTGVuZ3RoO1xuICAgIH1cbiAgICAvLyBtYXhsZW5ndGggdmFsaWRhdGlvblxuICAgIGlmIChcbiAgICAgIHZhbGlkYXRhYmxlSW5wdXQubWF4TGVuZ3RoICE9IG51bGwgJiZcbiAgICAgIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSBcInN0cmluZ1wiXG4gICAgKSB7XG4gICAgICBpc1ZhbGlkID1cbiAgICAgICAgaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlLmxlbmd0aCA8PSB2YWxpZGF0YWJsZUlucHV0Lm1heExlbmd0aDtcbiAgICB9XG4gICAgLy8gbWluIHZhbGlkYXRpb24gZm9yIHBlb3BsZVxuICAgIGlmIChcbiAgICAgIHZhbGlkYXRhYmxlSW5wdXQubWluICE9IG51bGwgJiZcbiAgICAgIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSBcIm51bWJlclwiXG4gICAgKSB7XG4gICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID49IHZhbGlkYXRhYmxlSW5wdXQubWluO1xuICAgIH1cbiAgICAvLyBtYXggdmFsaWRhdGlvbiBmb3IgcGVvcGxlXG4gICAgaWYgKFxuICAgICAgdmFsaWRhdGFibGVJbnB1dC5tYXggIT0gbnVsbCAmJlxuICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09IFwibnVtYmVyXCJcbiAgICApIHtcbiAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPD0gdmFsaWRhdGFibGVJbnB1dC5tYXg7XG4gICAgfVxuICAgIHJldHVybiBpc1ZhbGlkO1xuICB9XG4gIFxuIiwiXG4gICAgLy8gYXV0b2JpbmQgZGVjb3JhdG9yXG5leHBvcnQgZnVuY3Rpb24gQXV0b2JpbmQoXG4gICAgdGFyZ2V0OiBhbnksXG4gICAgbWV0aG9kTmFtZTogc3RyaW5nLFxuICAgIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvclxuICApIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0KCkge1xuICAgICAgICBjb25zdCBib3VuZEZuID0gb3JpZ2luYWxNZXRob2QuYmluZCh0aGlzKTtcbiAgICAgICAgcmV0dXJuIGJvdW5kRm47XG4gICAgICB9LFxuICAgIH07XG4gICAgcmV0dXJuIGFkakRlc2NyaXB0b3I7XG4gIH1cbiIsIlxuICAgIC8vIHByb2plY3QgdHlwZVxuZXhwb3J0IGVudW0gUHJvamVjdFN0YXR1cyB7XG4gICAgQWN0aXZlLFxuICAgIEZpbmlzaGVkLFxuICB9XG4gIGV4cG9ydCBjbGFzcyBQcm9qZWN0IHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgIHB1YmxpYyBpZDogc3RyaW5nLFxuICAgICAgcHVibGljIHRpdGxlOiBzdHJpbmcsXG4gICAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyxcbiAgICAgIHB1YmxpYyBwZW9wbGU6IG51bWJlcixcbiAgICAgIHB1YmxpYyBzdGF0dXM6IFByb2plY3RTdGF0dXNcbiAgICApIHt9XG4gIH1cbiIsImltcG9ydCB7IFByb2plY3RTdGF0dXMgfSBmcm9tIFwiLi4vbW9kZWxzL3Byb2plY3RcIjtcbmltcG9ydCB7IFByb2plY3QgfSBmcm9tIFwiLi4vbW9kZWxzL3Byb2plY3RcIjtcbiAgICAvLyBQcm9qZWN0IFN0YXRlIE1hbmFnZW1lbnRcbnR5cGUgTGlzdGVuZXI8VD4gPSAoaXRlbXM6IFRbXSkgPT4gdm9pZDtcblxuY2xhc3MgU3RhdGU8VD4ge1xuICBwcm90ZWN0ZWQgbGlzdGVuZXJzOiBMaXN0ZW5lcjxUPltdID0gW107XG4gIGFkZExpc3RlbmVyKGxpc3RlbmVyRm46IExpc3RlbmVyPFQ+KSB7XG4gICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lckZuKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUHJvamVjdFN0YXRlIGV4dGVuZHMgU3RhdGU8UHJvamVjdD4ge1xuICBwcml2YXRlIHByb2plY3RzOiBQcm9qZWN0W10gPSBbXTtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFByb2plY3RTdGF0ZTtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoKSB7XG4gICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcbiAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICAgIH1cbiAgICB0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdGF0ZSgpO1xuICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICB9XG5cbiAgYWRkUHJvamVjdCh0aXRsZTogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nLCBudW1PZlBlb3BsZTogbnVtYmVyKSB7XG4gICAgY29uc3QgbmV3UHJvamVjdCA9IG5ldyBQcm9qZWN0KFxuICAgICAgTWF0aC5yYW5kb20oKS50b1N0cmluZygpLFxuICAgICAgdGl0bGUsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIG51bU9mUGVvcGxlLFxuICAgICAgUHJvamVjdFN0YXR1cy5BY3RpdmVcbiAgICApO1xuICAgIHRoaXMucHJvamVjdHMucHVzaChuZXdQcm9qZWN0KTtcbiAgICB0aGlzLnVkcGF0ZUxpc3RlbmVycygpO1xuICB9XG4gIC8vIG1vdmUgcHJvamVjdCBmcm9tIGFjdGl2ZSB0byBmaW5pc2hlZFxuICBtb3ZlUHJvamVjdChwcm9qZWN0SWQ6IHN0cmluZywgbmV3U3RhdHVzOiBQcm9qZWN0U3RhdHVzKSB7XG4gICAgY29uc3QgcHJvamVjdCA9IHRoaXMucHJvamVjdHMuZmluZCgocHJvamVjdCkgPT4gcHJvamVjdC5pZCA9PT0gcHJvamVjdElkKTtcbiAgICBpZiAocHJvamVjdCAmJiBwcm9qZWN0LnN0YXR1cyAhPT0gbmV3U3RhdHVzKSB7XG4gICAgICBwcm9qZWN0LnN0YXR1cyA9IG5ld1N0YXR1cztcbiAgICAgIHRoaXMudWRwYXRlTGlzdGVuZXJzKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1ZHBhdGVMaXN0ZW5lcnMoKSB7XG4gICAgZm9yIChjb25zdCBsaXN0ZW5lckZuIG9mIHRoaXMubGlzdGVuZXJzKSB7XG4gICAgICBsaXN0ZW5lckZuKHRoaXMucHJvamVjdHMuc2xpY2UoKSk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBwcm9qZWN0U3RhdGUgPSBQcm9qZWN0U3RhdGUuZ2V0SW5zdGFuY2UoKTtcbiIsImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gXCIuL2Jhc2UtY29tcG9uZW50XCI7XG5pbXBvcnQgKiBhcyBWYWxpZGF0aW9uIGZyb20gXCIuLi91dGlsL3ZhbGlkYXRpb25cIjtcbmltcG9ydCB7IEF1dG9iaW5kIH0gZnJvbSBcIi4uL2RlY29yYXRvcnMvYXV0b2JpbmRcIjtcbmltcG9ydCB7IHByb2plY3RTdGF0ZSB9IGZyb20gXCIuLi9zdGF0ZS9wcm9qZWN0LXN0YXRlXCI7XG4gICAgLy8gUHJvamVjdElucHV0IENsYXNzXG5leHBvcnQgY2xhc3MgUHJvamVjdElucHV0IGV4dGVuZHMgQ29tcG9uZW50PEhUTUxEaXZFbGVtZW50LCBIVE1MRm9ybUVsZW1lbnQ+IHtcbiAgICB0aXRsZUlucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgICBkZXNjcmlwdGlvbklucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgICBwZW9wbGVJbnB1dEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gIFxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgc3VwZXIoXCJwcm9qZWN0LWlucHV0XCIsIFwiYXBwXCIsIHRydWUsIFwidXNlci1pbnB1dFwiKTtcbiAgXG4gICAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIFwiI3RpdGxlXCJcbiAgICAgICkgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgXG4gICAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIFwiI2Rlc2NyaXB0aW9uXCJcbiAgICAgICkgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgXG4gICAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBcIiNwZW9wbGVcIlxuICAgICAgKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICBcbiAgICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgfVxuICAgIGNvbmZpZ3VyZSgpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuc3VibWl0SGFuZGxlcik7XG4gICAgfVxuICAgIHJlbmRlckNvbnRlbnQoKTogdm9pZCB7fVxuICAgIHByaXZhdGUgZ2F0aGVyVXNlcklucHV0KCk6IFtzdHJpbmcsIHN0cmluZywgbnVtYmVyXSB8IHZvaWQge1xuICAgICAgY29uc3QgZW50ZXJlZFRpdGxlID0gdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZTtcbiAgICAgIGNvbnN0IGVudGVyZWREZXNjcmlwdGlvbiA9IHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWU7XG4gICAgICBjb25zdCBlbnRlcmVkUGVvcGxlID0gdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQudmFsdWU7XG4gIFxuICAgICAgY29uc3QgdGl0bGVWYWxpZGF0YWJsZTogVmFsaWRhdGlvbi5WYWxpZGF0YWJsZSA9IHtcbiAgICAgICAgdmFsdWU6IGVudGVyZWRUaXRsZSxcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICB9O1xuICAgICAgY29uc3QgZGVzY3JpcHRpb25WYWxpZGF0YWJsZTogVmFsaWRhdGlvbi5WYWxpZGF0YWJsZSA9IHtcbiAgICAgICAgdmFsdWU6IGVudGVyZWREZXNjcmlwdGlvbixcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIG1pbkxlbmd0aDogNSxcbiAgICAgIH07XG4gICAgICBjb25zdCBwZW9wbGVWYWxpZGF0YWJsZTogVmFsaWRhdGlvbi5WYWxpZGF0YWJsZSA9IHtcbiAgICAgICAgdmFsdWU6IGVudGVyZWRQZW9wbGUsXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICBtaW46IDEsXG4gICAgICB9O1xuICBcbiAgICAgIGlmIChcbiAgICAgICAgIVZhbGlkYXRpb24udmFsaWRhdGUodGl0bGVWYWxpZGF0YWJsZSkgfHxcbiAgICAgICAgIVZhbGlkYXRpb24udmFsaWRhdGUoZGVzY3JpcHRpb25WYWxpZGF0YWJsZSkgfHxcbiAgICAgICAgIVZhbGlkYXRpb24udmFsaWRhdGUocGVvcGxlVmFsaWRhdGFibGUpXG4gICAgICApIHtcbiAgICAgICAgYWxlcnQoXCJJbnZhbGlkIGlucHV0LCBwbGVhc2UgdHJ5IGFnYWluIVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFtlbnRlcmVkVGl0bGUsIGVudGVyZWREZXNjcmlwdGlvbiwgK2VudGVyZWRQZW9wbGVdO1xuICAgICAgfVxuICAgIH1cbiAgXG4gICAgcHJpdmF0ZSBjbGVhcklucHV0cygpIHtcbiAgICAgIHRoaXMudGl0bGVJbnB1dEVsZW1lbnQudmFsdWUgPSBcIlwiO1xuICAgICAgdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgfVxuICAgIEBBdXRvYmluZFxuICAgIHByaXZhdGUgc3VibWl0SGFuZGxlcihldmVudDogRXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCB1c2VySW5wdXQgPSB0aGlzLmdhdGhlclVzZXJJbnB1dCgpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodXNlcklucHV0KSkge1xuICAgICAgICBjb25zdCBbdGl0bGUsIGRlc2MsIHBlb3BsZV0gPSB1c2VySW5wdXQ7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRpdGxlLCBkZXMsIHBlb3BsZSk7XG4gICAgICAgIHByb2plY3RTdGF0ZS5hZGRQcm9qZWN0KHRpdGxlLCBkZXNjLCBwZW9wbGUpO1xuICAgICAgICB0aGlzLmNsZWFySW5wdXRzKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4iLCJpbXBvcnQgeyBEcmFnZ2FibGV9IGZyb20gJy4uL21vZGVscy9kcmFnLWRyb3AnXG5pbXBvcnQgeyBQcm9qZWN0IH0gZnJvbSAnLi4vbW9kZWxzL3Byb2plY3QnO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi9iYXNlLWNvbXBvbmVudCc7XG5pbXBvcnQgeyBBdXRvYmluZCB9IGZyb20gJy4uL2RlY29yYXRvcnMvYXV0b2JpbmQnO1xuXG4gICAgLy8gUHJvamVjdCBJdGVtIENsYXNzXG5leHBvcnQgY2xhc3MgUHJvamVjdEl0ZW1cbmV4dGVuZHMgQ29tcG9uZW50PEhUTUxVTGlzdEVsZW1lbnQsIEhUTUxFbGVtZW50PlxuaW1wbGVtZW50cyBEcmFnZ2FibGVcbntcbnByaXZhdGUgcHJvamVjdDogUHJvamVjdDtcblxuLy8gZGlzcGxheSBwZXJzb24gb3IgcGVyc29ucyBpbiB0aGUgZGlzcGxheVxuZ2V0IHBlcnNvbnMoKSB7XG4gIGlmICh0aGlzLnByb2plY3QucGVvcGxlID09PSAxKSB7XG4gICAgcmV0dXJuIFwiMSBwZXJzb25cIjtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYCR7dGhpcy5wcm9qZWN0LnBlb3BsZX0gcGVyc29uc2A7XG4gIH1cbn1cbmNvbnN0cnVjdG9yKGhvc3RJZDogc3RyaW5nLCBwcm9qZWN0OiBQcm9qZWN0KSB7XG4gIHN1cGVyKFwic2luZ2xlLXByb2plY3RcIiwgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XG4gIHRoaXMucHJvamVjdCA9IHByb2plY3Q7XG5cbiAgdGhpcy5jb25maWd1cmUoKTtcbiAgdGhpcy5yZW5kZXJDb250ZW50KCk7XG59XG5AQXV0b2JpbmRcbmRyYWdTdGFydEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQge1xuICBldmVudC5kYXRhVHJhbnNmZXIhLnNldERhdGEoXCJ0ZXh0L3BsYWluXCIsIHRoaXMucHJvamVjdC5pZCk7XG4gIGV2ZW50LmRhdGFUcmFuc2ZlciEuZWZmZWN0QWxsb3dlZCA9IFwibW92ZVwiO1xufVxuZHJhZ0VuZEhhbmRsZXIoXzogRHJhZ0V2ZW50KTogdm9pZCB7XG4gIGNvbnNvbGUubG9nKFwiRHJhZ0VuZFwiKTtcbn1cbmNvbmZpZ3VyZSgpIHtcbiAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnc3RhcnRcIiwgdGhpcy5kcmFnU3RhcnRIYW5kbGVyKTtcbiAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW5kXCIsIHRoaXMuZHJhZ0VuZEhhbmRsZXIpO1xufVxucmVuZGVyQ29udGVudCgpIHtcbiAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoMlwiKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QudGl0bGU7XG4gIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDNcIikhLnRleHRDb250ZW50ID1cbiAgICB0aGlzLnBlcnNvbnMudG9TdHJpbmcoKSArIFwiIGFzc2lnbmVkXCI7XG4gIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwicFwiKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QuZGVzY3JpcHRpb247XG59XG59XG4iLCJpbXBvcnQge0RyYWdUYXJnZXR9IGZyb20gJy4uL21vZGVscy9kcmFnLWRyb3AnXG5pbXBvcnQgeyBQcm9qZWN0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2plY3QnO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi9iYXNlLWNvbXBvbmVudCc7XG5pbXBvcnQgeyBBdXRvYmluZCB9IGZyb20gJy4uL2RlY29yYXRvcnMvYXV0b2JpbmQnO1xuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSAnLi4vc3RhdGUvcHJvamVjdC1zdGF0ZSc7XG5pbXBvcnQgeyBQcm9qZWN0SXRlbSB9IGZyb20gJy4vcHJvamVjdC1pdGVtJztcblxuICAgIC8vUHJvamVjdExpc3QgQ2xhc3NcbmV4cG9ydCBjbGFzcyBQcm9qZWN0TGlzdFxuZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxFbGVtZW50PlxuaW1wbGVtZW50cyBEcmFnVGFyZ2V0XG57XG5hc3NpZ25lZFByb2plY3RzOiBQcm9qZWN0W107XG5jb25zdHJ1Y3Rvcihwcml2YXRlIHR5cGU6IFwiYWN0aXZlXCIgfCBcImZpbmlzaGVkXCIpIHtcbiAgc3VwZXIoXCJwcm9qZWN0LWxpc3RcIiwgXCJhcHBcIiwgZmFsc2UsIGAke3R5cGV9LXByb2plY3RzYCk7XG4gIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IFtdO1xuXG4gIHRoaXMuY29uZmlndXJlKCk7XG4gIHRoaXMucmVuZGVyQ29udGVudCgpO1xufVxuXG5AQXV0b2JpbmRcbmRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZCB7XG4gIGlmIChldmVudC5kYXRhVHJhbnNmZXIgJiYgZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzWzBdID09PSBcInRleHQvcGxhaW5cIikge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKSE7XG4gICAgbGlzdEVsLmNsYXNzTGlzdC5hZGQoXCJkcm9wcGFibGVcIik7XG4gIH1cbn1cbkBBdXRvYmluZFxuZHJvcEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQge1xuICBjb25zdCBwcmpJZCA9IGV2ZW50LmRhdGFUcmFuc2ZlciEuZ2V0RGF0YShcInRleHQvcGxhaW5cIik7XG4gIHByb2plY3RTdGF0ZS5tb3ZlUHJvamVjdChcbiAgICBwcmpJZCxcbiAgICB0aGlzLnR5cGUgPT09IFwiYWN0aXZlXCIgPyBQcm9qZWN0U3RhdHVzLkFjdGl2ZSA6IFByb2plY3RTdGF0dXMuRmluaXNoZWRcbiAgKTtcbn1cbkBBdXRvYmluZFxuZHJhZ0xlYXZlSGFuZGxlcihfOiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKSE7XG4gIGxpc3RFbC5jbGFzc0xpc3QucmVtb3ZlKFwiZHJvcHBhYmxlXCIpO1xufVxuY29uZmlndXJlKCkge1xuICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIHRoaXMuZHJhZ092ZXJIYW5kbGVyKTtcbiAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnbGVhdmVcIiwgdGhpcy5kcmFnTGVhdmVIYW5kbGVyKTtcbiAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIHRoaXMuZHJvcEhhbmRsZXIpO1xuICBwcm9qZWN0U3RhdGUuYWRkTGlzdGVuZXIoKHByb2plY3RzOiBQcm9qZWN0W10pID0+IHtcbiAgICAvLyByZW5kZXIgYWN0aXZlIHByb2plY3QgdXNpbmcgZmlsdGVyaW5nXG4gICAgY29uc3QgcmVsZXZhbnRQcm9qZWN0cyA9IHByb2plY3RzLmZpbHRlcigocHJvamVjdCkgPT4ge1xuICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJhY3RpdmVcIikge1xuICAgICAgICByZXR1cm4gcHJvamVjdC5zdGF0dXMgPT09IFByb2plY3RTdGF0dXMuQWN0aXZlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHByb2plY3Quc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xuICAgIH0pO1xuICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IHJlbGV2YW50UHJvamVjdHM7XG4gICAgdGhpcy5yZW5kZXJQcm9qZWN0cygpO1xuICB9KTtcbn1cblxucmVuZGVyQ29udGVudCgpIHtcbiAgY29uc3QgbGlzdElkID0gYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YDtcbiAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ1bFwiKSEuaWQgPSBsaXN0SWQ7XG4gIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDJcIikhLnRleHRDb250ZW50ID1cbiAgICB0aGlzLnR5cGUudG9VcHBlckNhc2UoKSArIFwiIFBST0pFQ1RTXCI7XG59XG5cbnByaXZhdGUgcmVuZGVyUHJvamVjdHMoKSB7XG4gICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgICBgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgXG4gICAgKSEgYXMgSFRNTFVMaXN0RWxlbWVudDtcbiAgICBsaXN0RWwuaW5uZXJIVE1MID0gXCJcIjsgLy8gaW4gb3JkZXIgdG8gYXZvaWQgZHVwbGljYXRlXG4gICAgZm9yIChjb25zdCBwcm9qZWN0SXRlbSBvZiB0aGlzLmFzc2lnbmVkUHJvamVjdHMpIHtcbiAgICAgIG5ldyBQcm9qZWN0SXRlbSh0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInVsXCIpIS5pZCwgcHJvamVjdEl0ZW0pO1xuICAgIH1cbiAgfVxufVxuIiwiaW1wb3J0IHsgUHJvamVjdElucHV0IH0gZnJvbSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWlucHV0XCI7XG5pbXBvcnQgeyBQcm9qZWN0TGlzdCB9IGZyb20gXCIuL2NvbXBvbmVudHMvcHJvamVjdC1saXN0XCI7XG5cbm5ldyBQcm9qZWN0SW5wdXQoKTtcbm5ldyBQcm9qZWN0TGlzdChcImFjdGl2ZVwiKTtcbm5ldyBQcm9qZWN0TGlzdChcImZpbmlzaGVkXCIpO1xuXG5cbiJdLCJuYW1lcyI6WyJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInRlbXBsYXRlSWQiLCJob3N0RWxlbWVudElkIiwiaW5zZXJ0QXRTdGFydCIsIm5ld0VsZW1lbnRJZCIsInRoaXMiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaG9zdEVsZW1lbnQiLCJpbXBvcnRlZE5vZGUiLCJpbXBvcnROb2RlIiwiY29udGVudCIsImVsZW1lbnQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsImlkIiwiYXR0YWNoIiwiaW5zZXJ0QXRCZWdpbm5pbmciLCJpbnNlcnRBZGphY2VudEVsZW1lbnQiLCJ2YWxpZGF0ZSIsInZhbGlkYXRhYmxlSW5wdXQiLCJpc1ZhbGlkIiwicmVxdWlyZWQiLCJ2YWx1ZSIsInRvU3RyaW5nIiwidHJpbSIsImxlbmd0aCIsIm1pbkxlbmd0aCIsIm1heExlbmd0aCIsIm1pbiIsIm1heCIsIkF1dG9iaW5kIiwidGFyZ2V0IiwibWV0aG9kTmFtZSIsImRlc2NyaXB0b3IiLCJvcmlnaW5hbE1ldGhvZCIsImNvbmZpZ3VyYWJsZSIsImdldCIsImJpbmQiLCJQcm9qZWN0U3RhdHVzIiwiUHJvamVjdCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJwZW9wbGUiLCJzdGF0dXMiLCJTdGF0ZSIsImxpc3RlbmVycyIsImFkZExpc3RlbmVyIiwibGlzdGVuZXJGbiIsInB1c2giLCJQcm9qZWN0U3RhdGUiLCJzdXBlciIsInByb2plY3RzIiwiZ2V0SW5zdGFuY2UiLCJpbnN0YW5jZSIsImFkZFByb2plY3QiLCJudW1PZlBlb3BsZSIsIm5ld1Byb2plY3QiLCJNYXRoIiwicmFuZG9tIiwiQWN0aXZlIiwidWRwYXRlTGlzdGVuZXJzIiwibW92ZVByb2plY3QiLCJwcm9qZWN0SWQiLCJuZXdTdGF0dXMiLCJwcm9qZWN0IiwiZmluZCIsInNsaWNlIiwicHJvamVjdFN0YXRlIiwiUHJvamVjdElucHV0IiwidGl0bGVJbnB1dEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQiLCJwZW9wbGVJbnB1dEVsZW1lbnQiLCJjb25maWd1cmUiLCJhZGRFdmVudExpc3RlbmVyIiwic3VibWl0SGFuZGxlciIsInJlbmRlckNvbnRlbnQiLCJnYXRoZXJVc2VySW5wdXQiLCJlbnRlcmVkVGl0bGUiLCJlbnRlcmVkRGVzY3JpcHRpb24iLCJlbnRlcmVkUGVvcGxlIiwiZGVzY3JpcHRpb25WYWxpZGF0YWJsZSIsInBlb3BsZVZhbGlkYXRhYmxlIiwiYWxlcnQiLCJjbGVhcklucHV0cyIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ1c2VySW5wdXQiLCJBcnJheSIsImlzQXJyYXkiLCJkZXNjIiwiUHJvamVjdEl0ZW0iLCJwZXJzb25zIiwiaG9zdElkIiwiZHJhZ1N0YXJ0SGFuZGxlciIsImRhdGFUcmFuc2ZlciIsInNldERhdGEiLCJlZmZlY3RBbGxvd2VkIiwiZHJhZ0VuZEhhbmRsZXIiLCJfIiwiY29uc29sZSIsImxvZyIsInRleHRDb250ZW50IiwiUHJvamVjdExpc3QiLCJ0eXBlIiwiYXNzaWduZWRQcm9qZWN0cyIsImRyYWdPdmVySGFuZGxlciIsInR5cGVzIiwiY2xhc3NMaXN0IiwiYWRkIiwiZHJvcEhhbmRsZXIiLCJwcmpJZCIsImdldERhdGEiLCJGaW5pc2hlZCIsImRyYWdMZWF2ZUhhbmRsZXIiLCJyZW1vdmUiLCJyZWxldmFudFByb2plY3RzIiwiZmlsdGVyIiwicmVuZGVyUHJvamVjdHMiLCJsaXN0SWQiLCJ0b1VwcGVyQ2FzZSIsImlubmVySFRNTCIsInByb2plY3RJdGVtIl0sInNvdXJjZVJvb3QiOiIifQ==